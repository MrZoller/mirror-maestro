<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirror Maestro - Help</title>
    <link rel="stylesheet" href="../../app/static/css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-title-section">
                    <img src="../../app/static/images/logo.svg" alt="Mirror Maestro Logo" class="header-logo">
                    <div>
                        <h1>Mirror Maestro</h1>
                        <p>Orchestrate GitLab mirrors across multiple instance pairs with precision</p>
                    </div>
                </div>
                <div class="header-controls">
                    <div class="global-search-container">
                        <input type="search" id="global-search" class="global-search-input" placeholder="Search instances, pairs, mirrors..." aria-label="Global search">
                        <div id="global-search-results" class="global-search-results"></div>
                    </div>
                    <button id="dark-mode-toggle" class="dark-mode-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">
                        <span class="theme-icon theme-icon-light">‚òÄÔ∏è</span>
                        <span class="theme-icon theme-icon-dark">üåô</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab" data-tab="dashboard-tab">Dashboard</button>
            <button class="tab" data-tab="instances-tab">GitLab Instances</button>
            <button class="tab" data-tab="pairs-tab">Instance Pairs</button>
            <button class="tab" data-tab="mirrors-tab">Mirrors</button>
            <button class="tab" data-tab="topology-tab">Topology</button>
            <button class="tab" data-tab="backup-tab">Backup</button>
            <button class="tab" data-tab="settings-tab">Settings</button>
            <button class="tab" data-tab="about-tab">About</button>
            <button class="tab active" data-tab="help-tab">Help</button>
        </div>

        <!-- Help Tab -->
        <div id="help-tab" class="tab-content active">
            <!-- 1. Getting Started -->
            <div class="card">
                <h2>Getting Started</h2>
                <p class="text-muted">Welcome to Mirror Maestro - your tool for orchestrating GitLab mirrors across multiple instances.</p>

                <h3>What is Mirror Maestro?</h3>
                <p>Mirror Maestro simplifies the management of GitLab repository mirrors. Whether you need to sync repositories between GitLab instances, create backups, or maintain read-only copies, Mirror Maestro provides a centralized interface to configure and monitor all your mirrors.</p>

                <h3>Application Overview</h3>
                <p>Mirror Maestro is organized into several tabs, each focused on a specific aspect of mirror management:</p>
                <ul>
                    <li><strong><a href="#" onclick="return false;">Dashboard</a></strong> - Quick overview with statistics, recent activity, and system health</li>
                    <li><strong><a href="#" onclick="return false;">GitLab Instances</a></strong> - Manage connections to your GitLab servers</li>
                    <li><strong><a href="#" onclick="return false;">Instance Pairs</a></strong> - Configure mirroring relationships between instances</li>
                    <li><strong><a href="#" onclick="return false;">Mirrors</a></strong> - Create and manage individual repository mirrors</li>
                    <li><strong><a href="#" onclick="return false;">Topology</a></strong> - Visualize your mirror network with an interactive graph</li>
                    <li><strong><a href="#" onclick="return false;">Backup</a></strong> - Create and restore complete database backups</li>
                    <li><strong><a href="#" onclick="return false;">About</a></strong> - Project information and version details</li>
                    <li><strong><a href="#" onclick="return false;">Help</a></strong> - This comprehensive guide</li>
                </ul>

                <h3>Core Concepts</h3>
                <ul>
                    <li><strong>GitLab Instances</strong> - Your GitLab servers (self-hosted or GitLab.com). Each instance needs an access token with API permissions.</li>
                    <li><strong>Instance Pairs</strong> - A connection between two instances (or the same instance) that defines the mirroring direction and default settings.</li>
                    <li><strong>Mirrors</strong> - Individual repository mirrors that sync content from a source project to a target project.</li>
                </ul>

                <h3>Quick Start: Create Your First Mirror</h3>
                <ol>
                    <li><strong>Add a GitLab Instance</strong> - Go to <a href="#" onclick="return false;">GitLab Instances</a> and add your GitLab server with an access token.</li>
                    <li><strong>Create an Instance Pair</strong> - Go to <a href="#" onclick="return false;">Instance Pairs</a> and create a pair (can be the same instance for internal mirroring).</li>
                    <li><strong>Create a Mirror</strong> - Go to <a href="#" onclick="return false;">Mirrors</a>, select your pair, choose source and target projects, and create the mirror. Authentication tokens are managed automatically.</li>
                </ol>
            </div>

            <!-- 2. GitLab Instances -->
            <div class="card">
                <h2>GitLab Instances</h2>
                <p class="text-muted">Configure connections to your GitLab servers.</p>

                <h3>Required Token Permissions</h3>
                <p>The instance access token needs the following scopes:</p>
                <ul>
                    <li><strong>api</strong> - Full API access (required for creating and managing mirrors)</li>
                    <li><strong>read_repository</strong> - Read access to repositories (for pull mirrors)</li>
                    <li><strong>write_repository</strong> - Write access to repositories (for push mirrors)</li>
                </ul>
                <p>You can use a Personal Access Token (PAT) or a Project/Group Access Token with these scopes.</p>

                <h3>Adding an Instance</h3>
                <ol>
                    <li>Navigate to the <a href="#" onclick="return false;">GitLab Instances</a> tab</li>
                    <li>Fill in the instance name (e.g., "Production GitLab")</li>
                    <li>Enter the instance URL (e.g., <code>https://gitlab.example.com</code>)</li>
                    <li>Paste your access token</li>
                    <li>Click "Add Instance" - the connection will be tested automatically</li>
                </ol>

                <h3>Testing Connections</h3>
                <p>After adding an instance, Mirror Maestro verifies the token by fetching the authenticated user's information. If successful, you'll see the API username displayed in the instances table.</p>

                <h3>Deletion Behavior</h3>
                <div class="alert alert-warning">
                    <strong>&#9888;&#65039; Important:</strong> Deleting a GitLab instance performs a cascading delete with GitLab cleanup.
                </div>
                <p>When you delete an instance, the following happens:</p>
                <ol>
                    <li><strong>GitLab Cleanup</strong> - All mirrors and project access tokens are removed from GitLab using rate-limited API calls</li>
                    <li><strong>Database Cleanup</strong> - Instance pairs referencing this instance and their associated mirrors are deleted from the database</li>
                    <li><strong>Progress Tracking</strong> - The operation returns detailed metrics showing successful and failed cleanup operations</li>
                </ol>
                <p><strong>Rate Limiting:</strong> For instances with many mirrors, cleanup operations are throttled (default: 200ms between operations) to avoid overwhelming GitLab.</p>
                <p><strong>Best-Effort:</strong> If GitLab cleanup fails for some mirrors (e.g., network errors, expired tokens), the database deletion still proceeds, and warnings are returned.</p>
            </div>

            <!-- 3. Instance Pairs -->
            <div class="card">
                <h2>Instance Pairs</h2>
                <p class="text-muted">Define mirroring relationships between GitLab instances.</p>

                <h3>Push vs Pull Mirroring</h3>
                <table class="help-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Direction</th>
                            <th>Use Case</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Push</strong></td>
                            <td>Source &rarr; Target</td>
                            <td>The source repository pushes changes to the target. Best for active development repos pushing to backups or read-only copies.</td>
                        </tr>
                        <tr>
                            <td><strong>Pull</strong></td>
                            <td>Target &larr; Source</td>
                            <td>The target repository pulls changes from the source. Best when you want the target to control when it syncs.</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Creating a Pair</h3>
                <ol>
                    <li>Navigate to the <a href="#" onclick="return false;">Instance Pairs</a> tab</li>
                    <li>Enter a descriptive name (e.g., "Dev to Prod Sync")</li>
                    <li>Select the source and target instances</li>
                    <li>Choose the mirror direction (push or pull)</li>
                    <li>Configure default settings for mirrors in this pair</li>
                    <li>Click "Create Pair"</li>
                </ol>

                <h3>Pair-Level Default Settings</h3>
                <p>Settings configured on a pair become defaults for all mirrors in that pair. Individual mirrors can override these settings.</p>
                <ul>
                    <li><strong>Mirror protected branches only</strong> - Only sync branches that are protected</li>
                    <li><strong>Trigger builds</strong> - Run CI/CD pipelines on the target after sync</li>
                    <li><strong>Overwrite diverged branches</strong> - Force-update branches that have diverged</li>
                </ul>

                <h3>Bidirectional Mirroring</h3>
                <p>To sync repositories in both directions between two instances, create two instance pairs:</p>
                <ul>
                    <li><strong>Pair 1:</strong> Instance A &rarr; Instance B (e.g., "Production to Staging")</li>
                    <li><strong>Pair 2:</strong> Instance B &rarr; Instance A (e.g., "Staging to Production")</li>
                </ul>
                <p>Each pair can have independent settings (direction, branch filters, overwrite policies, etc.). The <a href="#" onclick="return false;">Topology</a> view will display both directions as separate links between the instances, making bidirectional relationships easy to visualize.</p>

                <h3>Batch Mirror Sync</h3>
                <p>The "Sync All" button in the Instance Pairs table allows you to trigger sync for all enabled mirrors in a pair with a single click. This is particularly useful when:</p>
                <ul>
                    <li><strong>Resuming after outages</strong> - When a GitLab instance goes down temporarily, all mirrors may stop syncing and need manual resumption</li>
                    <li><strong>Post-maintenance sync</strong> - After scheduled maintenance or upgrades</li>
                    <li><strong>Large-scale updates</strong> - When you need to sync hundreds of mirrors at once</li>
                </ul>

                <h4>How Batch Sync Works</h4>
                <p>When you click "Sync All", Mirror Maestro:</p>
                <ol>
                    <li>Fetches all enabled mirrors for the selected pair</li>
                    <li>Sequentially triggers each mirror's sync operation</li>
                    <li>Applies rate limiting between operations (default: 200ms delay)</li>
                    <li>Continues processing even if some mirrors fail</li>
                    <li>Returns a detailed summary with success/failure counts and timing metrics</li>
                </ol>

                <h4>Rate Limiting Protection</h4>
                <p>To prevent overwhelming GitLab instances with too many API requests, batch operations use intelligent rate limiting:</p>
                <ul>
                    <li><strong>Configurable delay</strong> - Default 200ms between operations (~300 requests/minute, well under GitLab's typical 600/min limit)</li>
                    <li><strong>Automatic retry</strong> - If GitLab returns a 429 "Too Many Requests" error, operations are retried with exponential backoff</li>
                    <li><strong>Progress tracking</strong> - Real-time progress with estimated completion time</li>
                    <li><strong>Detailed reporting</strong> - Shows which mirrors succeeded, failed, or were skipped</li>
                </ul>

                <h4>Example: Syncing 100 Mirrors</h4>
                <pre style="background: #f5f5f5; padding: 12px; border-radius: 4px; overflow-x: auto;"><code>With default settings (200ms delay):
- Total time: ~20 seconds
- Rate: ~300 operations/minute
- Well under GitLab's API limits
- Safe for large mirror sets</code></pre>

                <h3>Deletion Behavior</h3>
                <div class="alert alert-warning">
                    <strong>&#9888;&#65039; Important:</strong> Deleting an instance pair performs a cascading delete with GitLab cleanup.
                </div>
                <p>When you delete a pair, the following happens:</p>
                <ol>
                    <li><strong>GitLab Cleanup</strong> - All mirrors in the pair and their project access tokens are removed from GitLab using rate-limited API calls</li>
                    <li><strong>Database Cleanup</strong> - The pair and all associated mirrors are deleted from the database</li>
                    <li><strong>Progress Tracking</strong> - Returns detailed metrics showing successful and failed cleanup operations</li>
                </ol>
                <p><strong>Rate Limiting:</strong> For pairs with many mirrors, cleanup operations are throttled to avoid overwhelming GitLab (same rate limiting as batch sync).</p>
                <p><strong>Best-Effort:</strong> If GitLab cleanup fails for some mirrors, the database deletion still proceeds with warnings returned.</p>

                <h4>Example: Deleting Pair with 50 Mirrors</h4>
                <pre style="background: #f5f5f5; padding: 12px; border-radius: 4px; overflow-x: auto;"><code>Each mirror deletion = 2 GitLab API calls:
1. Delete mirror from project
2. Delete project access token

Total operations: 100 API calls
With 200ms delay: ~20 seconds total
Safe and controlled cleanup</code></pre>
            </div>

            <!-- 4. Authentication -->
            <div class="card">
                <h2>Authentication</h2>
                <p class="text-muted">How Mirror Maestro handles mirror authentication.</p>

                <h3>Automatic Token Management</h3>
                <p>Mirror Maestro automatically creates and manages project access tokens for each mirror. When you create a mirror, a token is generated on the appropriate project with the required permissions.</p>
                <ul>
                    <li><strong>Push mirrors</strong> - Token is created on the <em>target</em> project (with <code>write_repository</code> scope)</li>
                    <li><strong>Pull mirrors</strong> - Token is created on the <em>source</em> project (with <code>read_repository</code> scope)</li>
                </ul>

                <h3>Token Expiration</h3>
                <p>Tokens are created with a 1-year expiration. The mirror list shows token status:</p>
                <ul>
                    <li><span class="badge badge-success">Active</span> - Token is valid</li>
                    <li><span class="badge badge-warning">Expiring Soon</span> - Token expires within 30 days</li>
                    <li><span class="badge badge-danger">Expired</span> - Token has expired and needs rotation</li>
                </ul>

                <h3>Token Rotation</h3>
                <p>To rotate a token before it expires (or after it has expired), click the "Rotate Token" button on the mirror. This will create a new token and update the mirror configuration automatically.</p>
            </div>

            <!-- 5. Settings Hierarchy -->
            <div class="card">
                <h2>Settings Hierarchy</h2>
                <p class="text-muted">How mirror settings are resolved.</p>

                <h3>Two-Tier Resolution</h3>
                <p>Mirror settings are resolved in this order (first non-null value wins):</p>
                <ol>
                    <li><strong>Mirror-level</strong> - Settings on the individual mirror (highest priority)</li>
                    <li><strong>Pair-level</strong> - Default settings on the instance pair (fallback)</li>
                </ol>
                <p>This allows you to set sensible defaults on the instance pair and override them per-mirror as needed.</p>
            </div>

            <!-- 6. Creating Mirrors -->
            <div class="card">
                <h2>Creating Mirrors</h2>
                <p class="text-muted">Step-by-step guide to setting up repository mirrors.</p>

                <h3>Prerequisites</h3>
                <ul>
                    <li>At least one GitLab instance configured</li>
                    <li>An instance pair created</li>
                    <li>A group token for the source and/or target groups</li>
                    <li>Source and target projects must exist (Mirror Maestro doesn't create projects)</li>
                </ul>

                <h3>Creating a Mirror</h3>
                <ol>
                    <li>Navigate to the <a href="#" onclick="return false;">Mirrors</a> tab</li>
                    <li>Select an instance pair from the dropdown</li>
                    <li>Search and select the source project</li>
                    <li>Search and select the target project</li>
                    <li>Click "Preflight Check" to validate the configuration</li>
                    <li>Review the effective settings shown in the preflight results</li>
                    <li>Click "Create Mirror" to set up the mirror on GitLab</li>
                </ol>

                <h3>Preflight Checks</h3>
                <p>Before creating a mirror, the preflight check verifies:</p>
                <ul>
                    <li>Both projects are accessible</li>
                    <li>Required tokens are available</li>
                    <li>The effective mirror settings (combining mirror, group, and pair defaults)</li>
                </ul>

                <h3>Mirror Settings</h3>
                <ul>
                    <li><strong>Enabled</strong> - Toggle to enable/disable the mirror without deleting it</li>
                    <li><strong>Only protected branches</strong> - Sync only branches marked as protected</li>
                    <li><strong>Trigger builds</strong> - Run CI/CD on target after successful sync</li>
                    <li><strong>Overwrite diverged</strong> - Force-push if target has diverged from source</li>
                </ul>

                <h3>Syncing Mirrors</h3>
                <p>Mirrors sync automatically based on GitLab's schedule (typically every 5 minutes for push, on-demand for pull). You can manually trigger a sync using the "Update Now" button in the mirrors table.</p>
            </div>

            <!-- 7. Topology View -->
            <div class="card">
                <h2>Topology View</h2>
                <p class="text-muted">Visualize your mirror network with an interactive graph.</p>

                <h3>Understanding the Graph</h3>
                <ul>
                    <li><strong>Nodes</strong> - Each node represents a GitLab instance</li>
                    <li><strong>Links</strong> - Lines between nodes represent instance pairs</li>
                    <li><strong>Link colors</strong> - Blue for pull mirrors, orange for push mirrors</li>
                    <li><strong>Link thickness</strong> - Thicker links have more mirrors</li>
                </ul>

                <h3>Interacting with the Graph</h3>
                <ul>
                    <li><strong>Drag nodes</strong> - Rearrange the layout by dragging instances</li>
                    <li><strong>Click a node</strong> - See instance details and statistics</li>
                    <li><strong>Click a link</strong> - View all mirrors for that pair</li>
                    <li><strong>Zoom</strong> - Scroll to zoom in/out</li>
                    <li><strong>Pan</strong> - Click and drag the background to pan</li>
                </ul>

                <h3>Status Indicators</h3>
                <p>The graph shows mirror health at a glance:</p>
                <ul>
                    <li><strong>Green</strong> - All mirrors syncing successfully</li>
                    <li><strong>Yellow</strong> - Some mirrors have warnings or are stale</li>
                    <li><strong>Red</strong> - Mirrors have errors that need attention</li>
                </ul>
            </div>

            <!-- 8. Import/Export -->
            <div class="card">
                <h2>Import/Export</h2>
                <p class="text-muted">Bulk manage mirror configurations with portable JSON files.</p>

                <h3>How to Use</h3>
                <ol>
                    <li>Navigate to the <a href="#" onclick="return false;">Mirrors</a> tab</li>
                    <li>Select an instance pair from the dropdown</li>
                    <li>Click <strong>Export</strong> to download all mirrors for that pair as JSON</li>
                    <li>Click <strong>Import</strong> to upload a JSON file and create mirrors</li>
                </ol>

                <h3>Export Format</h3>
                <p>Exports are <strong>portable across environments</strong> (dev/staging/prod):</p>
                <ul>
                    <li><strong>Project paths</strong> (not IDs) - e.g., <code>group/subgroup/project</code></li>
                    <li><strong>Mirror settings</strong> - All configuration options (overwrite diverged, protected branches, etc.)</li>
                    <li><strong>Metadata</strong> (informational only) - Source/target instances, direction, export timestamp</li>
                </ul>

                <h3>What Happens During Import</h3>
                <p>When you import a JSON file, Mirror Maestro performs these steps for each mirror:</p>
                <ol>
                    <li><strong>Looks up project IDs</strong> from paths via GitLab API</li>
                    <li><strong>Creates project access tokens</strong> in GitLab</li>
                    <li><strong>Creates actual mirrors</strong> in GitLab (push or pull)</li>
                    <li><strong>Stores mirror records</strong> in the database</li>
                    <li><strong>Applies rate limiting</strong> - Waits 200ms before processing the next mirror</li>
                </ol>
                <p class="alert alert-info"><strong>Note:</strong> The result is <em>identical to creating mirrors via the UI</em>. This is not just a database import - it creates real, functional GitLab mirrors with authentication tokens.</p>

                <h4>Import Rate Limiting</h4>
                <p>Importing many mirrors can generate hundreds of GitLab API requests (each mirror requires ~4 API calls). To prevent overwhelming your GitLab instances:</p>
                <ul>
                    <li><strong>Sequential processing</strong> - Mirrors are created one at a time, not in parallel</li>
                    <li><strong>Automatic delays</strong> - 200ms delay between each mirror (configurable)</li>
                    <li><strong>Retry logic</strong> - Automatic retry with exponential backoff on rate limit errors</li>
                    <li><strong>Progress metrics</strong> - Import results include duration and operations/second</li>
                </ul>
                <p><strong>Example:</strong> Importing 100 mirrors takes approximately 40-60 seconds with default settings, processing at a safe rate of ~200-300 API requests/minute.</p>

                <h3>Import Results</h3>
                <p>After import completes, you'll see a detailed summary:</p>
                <ul>
                    <li><strong>Imported count</strong> - Successfully created mirrors</li>
                    <li><strong>Skipped count</strong> - Mirrors that already exist</li>
                    <li><strong>Skipped details</strong> - Which mirrors were skipped and why (e.g., <code>[1/10] group/existing &rarr; mirror/existing: Already exists in database</code>)</li>
                    <li><strong>Errors</strong> - Detailed list of failures with specific project paths (e.g., <code>[3/10] bad/project &rarr; mirror/bad: Project not found</code>)</li>
                </ul>

                <h3>Important Notes</h3>
                <ul>
                    <li><strong>Select the correct pair</strong> - Import creates mirrors for the currently selected pair, not the pair from the export file</li>
                    <li><strong>Metadata is ignored</strong> - Only the <code>mirrors</code> array is used during import</li>
                    <li><strong>Projects must exist</strong> - Both source and target projects must already exist in their respective GitLab instances</li>
                    <li><strong>Duplicates are skipped</strong> - If a mirror already exists (same source/target paths), it won't be created again</li>
                    <li><strong>Import continues on errors</strong> - If some mirrors fail, others will still be imported</li>
                    <li><strong>Use full project paths</strong> - Paths must be in format <code>namespace/project</code> or <code>group/subgroup/project</code> (not just project names)</li>
                </ul>

                <h3>Example Export Structure</h3>
                <pre style="background: #f5f5f5; padding: 12px; border-radius: 4px; overflow-x: auto;"><code>{
  "metadata": {
    "exported_at": "2024-01-15T10:30:00Z",
    "pair_name": "GitLab.com &rarr; Self-hosted",
    "source_instance_name": "GitLab.com",
    "target_instance_name": "Self-hosted",
    "mirror_direction": "push",
    "total_mirrors": 2
  },
  "mirrors": [
    {
      "source_project_path": "mygroup/project1",
      "target_project_path": "mirrors/project1",
      "mirror_overwrite_diverged": false,
      "only_mirror_protected_branches": true,
      "enabled": true
    }
  ]
}</code></pre>
            </div>

            <!-- 9. Backup & Restore -->
            <div class="card">
                <h2>Backup & Restore</h2>
                <p class="text-muted">Protect your Mirror Maestro configuration with backups.</p>

                <h3>Creating Backups</h3>
                <p>Regular backups protect against data loss from database corruption, accidental deletion, or server failures.</p>
                <ol>
                    <li>Navigate to the <a href="#" onclick="return false;">Backup</a> tab</li>
                    <li>Review the current database statistics (instances, pairs, mirrors, size)</li>
                    <li>Click "Create & Download Backup" to download a complete backup</li>
                    <li>Save the backup file (.tar.gz) to a secure location</li>
                </ol>

                <h3>What's Included in Backups</h3>
                <p>Each backup archive contains:</p>
                <ul>
                    <li><strong>Database</strong> - All instances, pairs, mirrors, and configurations</li>
                    <li><strong>Encryption key</strong> - Required to decrypt stored GitLab tokens</li>
                    <li><strong>Metadata</strong> - Timestamp and version information</li>
                </ul>

                <h3>Restoring from Backup</h3>
                <p><strong>&#9888;&#65039; Warning:</strong> Restoring replaces ALL current data. Always create a backup first!</p>
                <ol>
                    <li>Navigate to the <a href="#" onclick="return false;">Backup</a> tab</li>
                    <li>Ensure "Create backup before restore" is checked (recommended)</li>
                    <li>Click "Select Backup File" and choose your backup (.tar.gz)</li>
                    <li>Click "Restore Backup" and confirm the action</li>
                    <li>The application will reload with the restored data</li>
                </ol>

                <h3>Backup Best Practices</h3>
                <ul>
                    <li>Create backups regularly (daily or weekly recommended)</li>
                    <li>Store backups in a secure location separate from your server</li>
                    <li>Keep multiple backup versions (e.g., last 7 days)</li>
                    <li>Test restores periodically to verify backup integrity</li>
                    <li>Protect backup files - they contain encryption keys for all tokens</li>
                </ul>

                <h3>Migration Between Servers</h3>
                <p>Backups can be used to migrate Mirror Maestro to a new server:</p>
                <ol>
                    <li>Create a backup on the old server</li>
                    <li>Install Mirror Maestro on the new server</li>
                    <li>Upload and restore the backup on the new server</li>
                    <li>All instances, pairs, and mirrors will be migrated</li>
                </ol>
            </div>

            <!-- 10. Mirror Verification -->
            <div class="card">
                <h2>Mirror Verification</h2>
                <p class="text-muted">Detect externally modified or deleted mirrors.</p>

                <h3>Why Verify Mirrors?</h3>
                <p>Mirrors created through Mirror Maestro may be modified or deleted directly in GitLab by other users. Verification helps you detect:</p>
                <ul>
                    <li><strong>Orphan mirrors</strong> - Mirror was deleted from GitLab but still exists in Mirror Maestro's database</li>
                    <li><strong>Drifted mirrors</strong> - Mirror settings on GitLab no longer match what Mirror Maestro expects</li>
                </ul>

                <h3>How to Verify</h3>
                <ol>
                    <li>Navigate to the <a href="#" onclick="return false;">Mirrors</a> tab</li>
                    <li>Select an instance pair from the dropdown</li>
                    <li>Click <strong>Verify All</strong> to check all visible mirrors, or click <strong>Verify</strong> on individual rows</li>
                </ol>

                <h3>Verification Status</h3>
                <table class="help-table">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Meaning</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-success">&#10003;</span></td>
                            <td>Healthy - Mirror exists on GitLab with matching settings</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-danger">Orphan</span></td>
                            <td>Mirror was deleted from GitLab externally. Consider deleting from Mirror Maestro.</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-warning">Drift</span></td>
                            <td>Settings mismatch. Hover for details. You may want to re-sync the settings.</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-secondary">N/C</span></td>
                            <td>Not Created - Mirror record exists but was never created on GitLab</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-danger">Err</span></td>
                            <td>Verification error - Could not contact GitLab. Check instance connectivity.</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Settings Checked for Drift</h3>
                <ul>
                    <li><code>enabled</code> - Whether the mirror is active</li>
                    <li><code>only_protected_branches</code> - Branch filtering</li>
                    <li><code>keep_divergent_refs</code> - How to handle diverged branches</li>
                    <li><code>trigger_builds</code> - CI trigger setting (pull mirrors only)</li>
                    <li><code>mirror_branch_regex</code> - Branch regex filter (pull mirrors only)</li>
                </ul>

                <h3>External Mirror Indicator</h3>
                <p>When creating a new mirror, Mirror Maestro checks if the selected projects already have mirrors configured on GitLab:</p>
                <ul>
                    <li>Select a source or target project in the Create Mirror form</li>
                    <li>If mirrors exist, a warning badge appears: <span class="badge badge-warning">&#9888; 2 push, 1 pull</span></li>
                    <li>This helps you understand the current state before creating a new mirror</li>
                </ul>
                <p class="alert alert-info"><strong>Note:</strong> This checks GitLab directly, showing all mirrors on the project - including those created outside of Mirror Maestro.</p>
            </div>

            <!-- 11. Issue Mirroring -->
            <div class="card">
                <h2>Issue Mirroring</h2>
                <p class="text-muted">Automatically sync issues, comments, labels, and attachments between mirrored repositories.</p>

                <h3>What is Issue Mirroring?</h3>
                <p>In addition to syncing repository code, Mirror Maestro can synchronize GitLab issues between source and target projects. This keeps issue trackers in sync across instances, making it perfect for:</p>
                <ul>
                    <li>Maintaining consistent issue tracking across dev/staging/prod environments</li>
                    <li>Creating backup copies of issue data alongside code mirrors</li>
                    <li>Consolidating issues from multiple instances into a central tracking system</li>
                </ul>

                <h3>Configuring Issue Syncing</h3>
                <ol>
                    <li>Navigate to the <a href="#" onclick="return false;">Mirrors</a> tab and click the "Issue Configs" button</li>
                    <li>Click "Create Issue Config" and select a mirror</li>
                    <li>Configure what to sync:
                        <ul>
                            <li><strong>Sync Comments</strong> - Mirror all issue comments and notes</li>
                            <li><strong>Sync Labels</strong> - Copy labels to target issues</li>
                            <li><strong>Sync Attachments</strong> - Download and upload issue attachments</li>
                            <li><strong>Sync Weight/Time Tracking</strong> - Copy issue weight, time estimates, and time spent</li>
                            <li><strong>Sync Closed Issues</strong> - Include closed/resolved issues in sync</li>
                        </ul>
                    </li>
                    <li>Set the sync interval (5-1440 minutes, default: 15 minutes)</li>
                    <li>Click "Create Config" to enable automatic syncing</li>
                </ol>

                <h3>Production-Ready Robustness</h3>
                <p>Mirror Maestro's issue syncing is built for reliability in production environments with the following features:</p>

                <h4>Circuit Breaker Protection</h4>
                <p>Prevents cascading failures when GitLab instances experience issues:</p>
                <ul>
                    <li>After 5 consecutive failures (configurable), the sync pauses automatically</li>
                    <li>Waits 60 seconds (configurable) before attempting recovery</li>
                    <li>Protects both your Mirror Maestro server and GitLab instances from overload</li>
                </ul>

                <h4>Automatic Retry with Backoff</h4>
                <p>Transient network errors don't stop your syncs:</p>
                <ul>
                    <li>Automatically retries failed operations up to 3 times</li>
                    <li>Uses exponential backoff (1s, 2s, 4s delays) to avoid overwhelming the API</li>
                    <li>Distinguishes between retryable errors (network) and permanent failures (permissions)</li>
                </ul>

                <h4>Progress Checkpointing</h4>
                <p>Large syncs can be interrupted and resumed without data loss:</p>
                <ul>
                    <li>Processes issues in batches of 50 (configurable)</li>
                    <li>Commits progress after each batch to the database</li>
                    <li>If interrupted, next sync resumes from where it left off</li>
                    <li>Perfect for syncing thousands of issues safely</li>
                </ul>

                <h4>Memory Management</h4>
                <p>Efficiently handles large repositories without exhausting resources:</p>
                <ul>
                    <li>Batched processing prevents loading all issues into memory at once</li>
                    <li>Streaming downloads for attachments</li>
                    <li>Pagination limits prevent API response overload (max 100 pages)</li>
                    <li>Maximum 10,000 issues per sync (configurable)</li>
                </ul>

                <h4>Attachment Safety</h4>
                <p>Protects against oversized file transfers:</p>
                <ul>
                    <li>Default 100MB limit per attachment (configurable)</li>
                    <li>Checks file size before downloading (via Content-Length header)</li>
                    <li>Validates actual content size after download</li>
                    <li>Set to 0 for unlimited size (use with caution)</li>
                </ul>

                <h4>Rate Limiting</h4>
                <p>Stays within GitLab's API quotas:</p>
                <ul>
                    <li>Automatic 200ms delay between operations (~300 ops/min)</li>
                    <li>Well under GitLab's 600 requests/min limit</li>
                    <li>Prevents API quota exhaustion even with large syncs</li>
                </ul>

                <h4>Graceful Shutdown</h4>
                <p>Safe deployment and maintenance:</p>
                <ul>
                    <li>Active sync jobs complete before shutdown</li>
                    <li>Configurable timeout (default: 300 seconds)</li>
                    <li>No data loss during restarts or deployments</li>
                    <li>Partially completed syncs resume on next run</li>
                </ul>

                <h3>Configuration Options</h3>
                <p>Advanced settings can be configured via environment variables:</p>
                <table class="help-table">
                    <thead>
                        <tr>
                            <th>Setting</th>
                            <th>Default</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>CIRCUIT_BREAKER_FAILURE_THRESHOLD</code></td>
                            <td>5</td>
                            <td>Failures before circuit opens</td>
                        </tr>
                        <tr>
                            <td><code>CIRCUIT_BREAKER_RECOVERY_TIMEOUT</code></td>
                            <td>60</td>
                            <td>Seconds to wait before recovery attempt</td>
                        </tr>
                        <tr>
                            <td><code>MAX_ISSUES_PER_SYNC</code></td>
                            <td>10000</td>
                            <td>Maximum issues to process in one sync</td>
                        </tr>
                        <tr>
                            <td><code>MAX_PAGES_PER_REQUEST</code></td>
                            <td>100</td>
                            <td>Maximum API pagination pages</td>
                        </tr>
                        <tr>
                            <td><code>MAX_ATTACHMENT_SIZE_MB</code></td>
                            <td>100</td>
                            <td>Maximum attachment size in MB (0=unlimited)</td>
                        </tr>
                        <tr>
                            <td><code>ATTACHMENT_DOWNLOAD_TIMEOUT</code></td>
                            <td>30</td>
                            <td>Timeout for downloading attachments (seconds)</td>
                        </tr>
                        <tr>
                            <td><code>ISSUE_BATCH_SIZE</code></td>
                            <td>50</td>
                            <td>Issues per checkpoint batch</td>
                        </tr>
                        <tr>
                            <td><code>SYNC_SHUTDOWN_TIMEOUT</code></td>
                            <td>300</td>
                            <td>Max wait for syncs during shutdown (seconds)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Monitoring Sync Status</h3>
                <p>Track your issue syncs in the Issue Configs view:</p>
                <ul>
                    <li><strong>Last Sync</strong> - Timestamp of most recent sync</li>
                    <li><strong>Status</strong> - Success, failed, or in progress</li>
                    <li><strong>Next Sync</strong> - When the next automatic sync will run</li>
                    <li><strong>Error Message</strong> - Details if sync failed</li>
                    <li><strong>Manual Trigger</strong> - Force immediate sync with "Trigger Sync" button</li>
                </ul>

                <h3>Best Practices</h3>
                <ul>
                    <li>Start with a short sync interval (15 min) for active projects</li>
                    <li>For initial syncs of large repos, consider disabling sync_existing_issues temporarily</li>
                    <li>Monitor attachment sizes - large files can slow syncs significantly</li>
                    <li>Use longer intervals (60+ min) for archived or infrequently updated projects</li>
                    <li>Check sync status regularly to catch configuration issues early</li>
                    <li>Increase batch size for repositories with thousands of issues to reduce overhead</li>
                </ul>
            </div>

            <!-- 12. System Health -->
            <div class="card">
                <h2>System Health</h2>
                <p class="text-muted">Monitor the health of your Mirror Maestro installation.</p>

                <h3>Health Dashboard</h3>
                <p>The <a href="#" onclick="return false;">Dashboard</a> includes a System Health card that shows the overall status of your Mirror Maestro installation at a glance. Health status is calculated based on:</p>
                <ul>
                    <li><strong>Database connectivity</strong> - Ensures the database is accessible</li>
                    <li><strong>Mirror sync status</strong> - Checks for failed mirrors</li>
                    <li><strong>Token expiration</strong> - Monitors for expiring or expired tokens</li>
                </ul>

                <h3>Health Status Levels</h3>
                <table class="help-table">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Meaning</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-success">Healthy</span></td>
                            <td>All systems operational. Database connected, mirrors syncing, tokens valid.</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-warning">Degraded</span></td>
                            <td>Some issues detected. May have failed mirrors, expiring tokens, or unreachable instances.</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-danger">Unhealthy</span></td>
                            <td>Critical issues. Database may be down, most mirrors failing, or other severe problems.</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Health API Endpoints</h3>
                <p>Mirror Maestro provides health check endpoints for monitoring tools and load balancers:</p>
                <table class="help-table">
                    <thead>
                        <tr>
                            <th>Endpoint</th>
                            <th>Auth</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>GET /api/health/quick</code></td>
                            <td>No</td>
                            <td>Fast health check for load balancers. Returns immediately without checking dependencies.</td>
                        </tr>
                        <tr>
                            <td><code>GET /api/health</code></td>
                            <td>Yes</td>
                            <td>Detailed health check with component status, mirror statistics, and token expiration info.</td>
                        </tr>
                        <tr>
                            <td><code>GET /api/health?check_instances=true</code></td>
                            <td>Yes</td>
                            <td>Extended health check that also tests connectivity to all GitLab instances (slower).</td>
                        </tr>
                        <tr>
                            <td><code>GET /health</code></td>
                            <td>No</td>
                            <td>Legacy endpoint for backward compatibility.</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Monitoring Best Practices</h3>
                <ul>
                    <li>Use <code>/api/health/quick</code> for frequent polling (e.g., every 10 seconds)</li>
                    <li>Use <code>/api/health</code> for less frequent detailed checks (e.g., every minute)</li>
                    <li>Set up alerts for "degraded" or "unhealthy" status</li>
                    <li>Monitor token expiration warnings and rotate tokens before they expire</li>
                    <li>Check the Dashboard regularly to review mirror sync failures</li>
                </ul>
            </div>

            <!-- 13. Troubleshooting -->
            <div class="card">
                <h2>Troubleshooting</h2>
                <p class="text-muted">Common issues and how to resolve them.</p>

                <h3>Connection Errors</h3>
                <table class="help-table">
                    <thead>
                        <tr>
                            <th>Error</th>
                            <th>Cause</th>
                            <th>Solution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>401 Unauthorized</code></td>
                            <td>Invalid or expired token</td>
                            <td>Regenerate the access token and update the instance configuration</td>
                        </tr>
                        <tr>
                            <td><code>403 Forbidden</code></td>
                            <td>Token lacks required scopes</td>
                            <td>Ensure the token has <code>api</code>, <code>read_repository</code>, and <code>write_repository</code> scopes</td>
                        </tr>
                        <tr>
                            <td><code>Connection refused</code></td>
                            <td>Network/firewall issue</td>
                            <td>Check that the GitLab instance is reachable from the Mirror Maestro server</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Mirror Sync Failures</h3>
                <table class="help-table">
                    <thead>
                        <tr>
                            <th>Error</th>
                            <th>Cause</th>
                            <th>Solution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Remote host key changed</code></td>
                            <td>SSH host key mismatch</td>
                            <td>Use HTTPS URLs instead of SSH, or update known hosts on GitLab server</td>
                        </tr>
                        <tr>
                            <td><code>Diverged branches</code></td>
                            <td>Target has commits not in source</td>
                            <td>Enable "Overwrite diverged branches" if you want to force-sync</td>
                        </tr>
                        <tr>
                            <td><code>Repository not found</code></td>
                            <td>Project deleted or moved</td>
                            <td>Update the mirror with the new project path or delete the mirror</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Checking Mirror Status</h3>
                <ol>
                    <li>Go to the <a href="#" onclick="return false;">Mirrors</a> tab</li>
                    <li>Find your mirror in the table</li>
                    <li>Check the "Status" column for the current state</li>
                    <li>Click "Details" or "Refresh Status" for more information</li>
                    <li>The "Last Sync" column shows when the mirror last synced successfully</li>
                </ol>

                <h3>Getting Help</h3>
                <p>If you encounter issues not covered here:</p>
                <ul>
                    <li>Check the GitLab project's mirror settings directly in the GitLab UI</li>
                    <li>Review GitLab's documentation on <a href="https://docs.gitlab.com/ee/user/project/repository/mirror/" target="_blank" rel="noopener">repository mirroring</a></li>
                    <li>Open an issue on the <a href="https://github.com/MrZoller/mirror-maestro/issues" target="_blank" rel="noopener">Mirror Maestro GitHub repository</a></li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
