<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirror Maestro - Backup & Restore</title>
    <link rel="stylesheet" href="../../app/static/css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-title-section">
                    <img src="../../app/static/images/logo.svg" alt="Mirror Maestro Logo" class="header-logo">
                    <div>
                        <h1>Mirror Maestro</h1>
                        <p>Orchestrate GitLab mirrors across multiple instance pairs with precision</p>
                    </div>
                </div>
                <div class="header-controls">
                    <div class="global-search-container">
                        <input type="search" id="global-search" class="global-search-input" placeholder="Search instances, pairs, mirrors..." aria-label="Global search">
                        <div id="global-search-results" class="global-search-results"></div>
                    </div>
                    <button id="dark-mode-toggle" class="dark-mode-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">
                        <span class="theme-icon theme-icon-light">‚òÄÔ∏è</span>
                        <span class="theme-icon theme-icon-dark">üåô</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab" data-tab="dashboard-tab">Dashboard</button>
            <button class="tab" data-tab="instances-tab">GitLab Instances</button>
            <button class="tab" data-tab="pairs-tab">Instance Pairs</button>
            <button class="tab" data-tab="mirrors-tab">Mirrors</button>
            <button class="tab" data-tab="topology-tab">Topology</button>
            <button class="tab active" data-tab="backup-tab">Backup</button>
            <button class="tab" data-tab="settings-tab">Settings</button>
            <button class="tab" data-tab="about-tab">About</button>
            <button class="tab" data-tab="help-tab">Help</button>
        </div>

        <!-- Backup Tab -->
        <div id="backup-tab" class="tab-content active">
            <div class="card">
                <h2>Backup & Restore</h2>
                <p class="text-muted">Create and restore complete backups of your Mirror Maestro database and encryption key.</p>
            </div>

            <!-- Create Backup -->
            <div class="card">
                <h3>üì¶ Create Backup</h3>
                <p>Download a complete backup of your Mirror Maestro configuration.</p>

                <div class="backup-info">
                    <div class="backup-stat-grid">
                        <div class="backup-stat">
                            <div class="backup-stat-label">GitLab Instances</div>
                            <div class="backup-stat-value" id="backup-stat-instances">4</div>
                        </div>
                        <div class="backup-stat">
                            <div class="backup-stat-label">Instance Pairs</div>
                            <div class="backup-stat-value" id="backup-stat-pairs">3</div>
                        </div>
                        <div class="backup-stat">
                            <div class="backup-stat-label">Mirrors</div>
                            <div class="backup-stat-value" id="backup-stat-mirrors">13</div>
                        </div>
                        <div class="backup-stat">
                            <div class="backup-stat-label">Database Size</div>
                            <div class="backup-stat-value" id="backup-stat-size">1.2 MB</div>
                        </div>
                    </div>

                    <div class="backup-includes">
                        <p><strong>Backup includes:</strong></p>
                        <ul>
                            <li>All GitLab instances (with encrypted tokens)</li>
                            <li>All instance pairs (with default settings)</li>
                            <li>All mirrors (with configurations and status)</li>
                            <li>Encryption key (required to decrypt tokens)</li>
                        </ul>
                    </div>

                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è Security Warning:</strong> Backup files contain your encryption key and can decrypt all stored GitLab tokens. Store backups securely and never share them publicly!
                    </div>
                </div>

                <button id="create-backup-btn" class="btn btn-primary">
                    <span id="create-backup-text">Create & Download Backup</span>
                    <span id="create-backup-spinner" class="btn-spinner" style="display:none;">
                        <div class="spinner"></div>
                    </span>
                </button>
            </div>

            <!-- Restore from Backup -->
            <div class="card">
                <h3>üì§ Restore from Backup</h3>
                <p>Restore your configuration from a backup file.</p>

                <div class="alert alert-danger">
                    <strong>‚ö†Ô∏è Warning:</strong> Restoring will REPLACE all current data including:
                    <ul>
                        <li>All GitLab instances</li>
                        <li>All instance pairs</li>
                        <li>All mirrors</li>
                        <li>The encryption key</li>
                    </ul>
                    This action cannot be undone. Make sure you have a current backup before proceeding.
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="backup-before-restore" checked>
                        Create backup before restore (recommended)
                    </label>
                    <p class="text-muted" style="margin-top: 8px;">
                        Automatically creates a backup of your current data before restoring.
                    </p>
                </div>

                <div class="backup-upload">
                    <input type="file" id="restore-file-input" accept=".tar.gz" style="display:none;">
                    <button id="select-backup-btn" class="btn btn-secondary">Select Backup File</button>
                    <span id="restore-filename" class="text-muted">No file selected</span>
                </div>

                <button id="restore-backup-btn" class="btn btn-danger" disabled>
                    <span id="restore-backup-text">Restore Backup</span>
                    <span id="restore-backup-spinner" class="btn-spinner" style="display:none;">
                        <div class="spinner"></div>
                    </span>
                </button>
            </div>

            <!-- Backup Information -->
            <div class="card">
                <h3>‚ÑπÔ∏è Backup Information</h3>
                <ul>
                    <li><strong>Format:</strong> Backups are compressed archives (.tar.gz)</li>
                    <li><strong>Portability:</strong> Compatible across Mirror Maestro versions and servers</li>
                    <li><strong>Migration:</strong> Can be used to migrate between different servers</li>
                    <li><strong>Security:</strong> Encryption key is included - keep backups safe!</li>
                    <li><strong>Automatic naming:</strong> Files are named <code>mirror-maestro-backup-YYYYMMDD-HHMMSS.tar.gz</code></li>
                </ul>

                <h4>Best Practices</h4>
                <ul>
                    <li>Create regular backups (daily or weekly depending on your change frequency)</li>
                    <li>Store backups in a secure location separate from your Mirror Maestro server</li>
                    <li>Test your backups periodically to ensure they can be restored</li>
                    <li>Keep multiple backup versions in case of corruption</li>
                    <li>Use encryption or access controls on your backup storage</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
